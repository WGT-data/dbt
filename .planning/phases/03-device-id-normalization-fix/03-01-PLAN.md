---
phase: 03-mta-limitations-mmm-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/03-device-id-normalization-fix/mta-limitations.md
  - models/marts/attribution/mta__campaign_performance.sql
  - models/marts/attribution/mta__network_comparison.sql
  - models/intermediate/int_mta__user_journey.sql
  - models/intermediate/int_mta__touchpoint_credit.sql
  - models/intermediate/int_adjust_amplitude__device_mapping.sql
autonomous: true

must_haves:
  truths:
    - "Stakeholder-facing document explains why device-level MTA cannot work for Android (0% match) and has limited iOS coverage (~7% IDFA)"
    - "Existing MTA models are preserved as-is (not deleted) with limitation headers documenting known constraints"
    - "Document clearly states MMM is the recommended strategic alternative"
  artifacts:
    - path: ".planning/phases/03-device-id-normalization-fix/mta-limitations.md"
      provides: "Stakeholder-facing MTA limitations document"
      contains: "Android.*0%"
    - path: "models/marts/attribution/mta__campaign_performance.sql"
      provides: "MTA mart with limitation header"
      contains: "LIMITATION"
    - path: "models/marts/attribution/mta__network_comparison.sql"
      provides: "MTA mart with limitation header"
      contains: "LIMITATION"
  key_links:
    - from: "mta-limitations.md"
      to: "Phase 2 findings"
      via: "References audit data from 02-02-SUMMARY.md"
      pattern: "0%.*Android|Android.*0%"
---

<objective>
Document MTA structural limitations and formally close MTA development work.

Purpose: Phase 2 proved that Android device matching is structurally impossible (0% match rate -- Amplitude SDK generates random UUIDs, not GPS_ADID) and iOS IDFA coverage is ~7%. This plan creates stakeholder-facing documentation explaining why MTA cannot work for strategic budget allocation, preserves existing MTA models with limitation headers, and formally pivots the project toward MMM.

Output: One stakeholder-facing limitations document + limitation comment headers added to 5 existing MTA/device-mapping models.
</objective>

<execution_context>
@/Users/riley/.claude/get-shit-done/workflows/execute-plan.md
@/Users/riley/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-device-id-audit/02-02-SUMMARY.md
@.planning/phases/02-device-id-audit/findings/baseline-match-rates.md
@.planning/phases/02-device-id-audit/findings/ios-att-limitations.md
@.planning/phases/02-device-id-audit/findings/normalization-strategy.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create stakeholder-facing MTA limitations document</name>
  <files>.planning/phases/03-device-id-normalization-fix/mta-limitations.md</files>
  <action>
Create a stakeholder-facing document at `.planning/phases/03-device-id-normalization-fix/mta-limitations.md` that explains why Multi-Touch Attribution (MTA) is not viable for strategic budget allocation. This document targets non-technical stakeholders (marketing managers, VPs).

Structure the document as follows:

1. **Executive Summary** (3-4 sentences): MTA requires matching individual ad touchpoints to in-app behavior via device IDs. Phase 2 audit proved this matching is structurally broken for Android (0% match rate) and limited for iOS (~7% IDFA consent). Recommend pivoting to Marketing Mix Modeling (MMM) for strategic budget allocation. MTA models remain available for iOS-only tactical analysis.

2. **What We Investigated** (brief): Phase 2 ran 17 audit queries against production Snowflake data covering 84,145 Android installs and 81,463 iOS installs from the last 60 days.

3. **Android: Why MTA Cannot Work** (key section):
   - Amplitude's Android SDK generates a random UUID as DEVICE_ID (not Google Advertising ID)
   - 70% of Android Amplitude device IDs have 'R' suffix marking them as random
   - 0 out of 76,159 Adjust GPS_ADID values matched ANY of 695,528 Amplitude device IDs
   - This is NOT a bug -- it is how Amplitude's SDK is configured
   - Fix requires mobile engineering team to configure `useAdvertisingIdForDeviceId()` in the Amplitude SDK -- outside dbt scope

4. **iOS: Limited Coverage** (key section):
   - IDFV matching works at 69.78% (device-to-device match)
   - But IDFA (required for cross-app touchpoint matching) is only available for 7.37% of installs due to Apple's ATT framework
   - Industry average for gaming apps: 12-19% ATT consent
   - WGT is below industry average, limiting iOS MTA to tactical use only

5. **Self-Attributing Networks (SANs)** (key section):
   - Meta, Google, Apple Search Ads, and TikTok never share touchpoint data
   - MTA will always show 0% credit for these networks regardless of device matching
   - These are typically the largest spend channels

6. **What This Means for Budget Decisions**:
   - MTA cannot be used for strategic budget allocation across channels
   - Recommend Marketing Mix Modeling (MMM) which uses aggregate data (daily spend, installs, revenue by channel) -- no device matching needed
   - MMM is the industry-standard approach in the post-ATT privacy era
   - dbt pipeline will prepare aggregate MMM input data; statistical modeling happens in specialized tools (PyMC, Robyn, etc.)

7. **What Stays Available**:
   - Existing MTA models preserved for iOS-only tactical analysis
   - Adjust's own last-click attribution remains available at campaign level
   - Aggregate channel performance data (spend, installs, revenue) continues to work

8. **Required External Actions** (for tracking):
   - Amplitude SDK configuration change for Android (mobile engineering team)
   - No timeline or pressure -- just documented as the path to eventual Android MTA

Use plain language. Avoid jargon. Use "CAN measure" / "CANNOT measure" format where appropriate. Reference specific numbers from Phase 2 audit findings.
  </action>
  <verify>
File exists at `.planning/phases/03-device-id-normalization-fix/mta-limitations.md`. File contains sections on Android 0% match, iOS IDFA 7.37%, SANs, and MMM recommendation. File does NOT contain code or SQL.
  </verify>
  <done>Stakeholder-facing document exists that clearly explains MTA limitations with real data, recommends MMM pivot, and documents required external actions.</done>
</task>

<task type="auto">
  <name>Task 2: Add limitation headers to existing MTA and device mapping models</name>
  <files>
models/marts/attribution/mta__campaign_performance.sql
models/marts/attribution/mta__network_comparison.sql
models/intermediate/int_mta__user_journey.sql
models/intermediate/int_mta__touchpoint_credit.sql
models/intermediate/int_adjust_amplitude__device_mapping.sql
  </files>
  <action>
Add a multi-line SQL comment block at the TOP of each of the 5 files listed above (before any existing comments or config blocks). The comment block should follow this template:

```sql
-- ============================================================================
-- LIMITATION NOTICE (documented Phase 3, 2026-02)
--
-- This model is part of the Multi-Touch Attribution (MTA) pipeline.
-- Phase 2 audit (Feb 2026) found that MTA has structural coverage limitations:
--   - Android: 0% device match rate (Amplitude SDK uses random UUID, not GPS_ADID)
--   - iOS IDFA: 7.37% availability (Apple ATT framework)
--   - SANs (Meta, Google, Apple, TikTok): 0% touchpoint data (never shared)
--
-- This model is PRESERVED for iOS tactical analysis only.
-- For strategic budget allocation, use MMM models in marts/mmm/.
--
-- To fix Android: Amplitude SDK must be configured with useAdvertisingIdForDeviceId()
-- See: .planning/phases/03-device-id-normalization-fix/mta-limitations.md
-- ============================================================================
```

For `int_adjust_amplitude__device_mapping.sql` specifically, add an additional line:
```
-- STATUS: Never built to production. Static table ADJUST_AMPLITUDE_DEVICE_MAPPING
-- (stale since Nov 2025) is the only existing mapping. iOS IDFV-only.
```

Do NOT modify any SQL logic, config blocks, or existing functionality. Only prepend the comment block.

Read each file first to understand the existing header comments, then prepend the limitation notice before whatever is currently at line 1.
  </action>
  <verify>
Each of the 5 files has the limitation notice as the first lines. Run: `head -15 models/marts/attribution/mta__campaign_performance.sql` and `head -15 models/intermediate/int_mta__user_journey.sql` to confirm the notice is present. Verify no SQL logic was changed by checking that `git diff --stat` shows only the 5 expected files modified with only additions (no deletions of existing lines).
  </verify>
  <done>All 5 MTA-related models have limitation headers documenting the structural constraints found in Phase 2, pointing users to MMM models and the limitations document.</done>
</task>

</tasks>

<verification>
1. `.planning/phases/03-device-id-normalization-fix/mta-limitations.md` exists with stakeholder-facing content
2. All 5 MTA model files have limitation headers as first lines
3. No MTA model SQL logic was changed (only comment additions)
4. `git diff` shows only additions to the 5 model files + 1 new documentation file
</verification>

<success_criteria>
- MTA limitations formally documented with real data from Phase 2 audit
- Existing MTA models preserved with clear limitation notices
- Stakeholders can understand why MTA cannot work without reading code
- Path forward (MMM) is clearly stated
</success_criteria>

<output>
After completion, create `.planning/phases/03-device-id-normalization-fix/03-01-SUMMARY.md`
</output>
