version: 2

models:
  - name: int_mmm__daily_channel_spend
    description: >
      Daily marketing spend aggregated by channel and platform for MMM input.
      Source: Supermetrics adj_campaign data. Channel taxonomy via network_mapping seed.
    columns:
      - name: DATE
        description: Calendar date of spend
        data_tests:
          - not_null
      - name: PLATFORM
        description: "iOS or Android"
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: ['iOS', 'Android']
      - name: CHANNEL
        description: "Standardized ad partner name (Meta, Google, TikTok, etc.)"
        data_tests:
          - not_null
      - name: SPEND
        description: Total marketing cost for this date+platform+channel
      - name: IMPRESSIONS
        description: Total ad impressions
      - name: CLICKS
        description: Total ad clicks
      - name: PAID_INSTALLS
        description: Paid installs reported by Supermetrics
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns:
              - DATE
              - PLATFORM
              - CHANNEL

  - name: int_mmm__daily_channel_installs
    description: >
      Daily install counts by channel and platform for MMM input.
      Source: Device-level Adjust S3 install data (v_stg_adjust__installs).
      More accurate than API aggregates because it counts distinct devices.
    columns:
      - name: DATE
        description: Calendar date of install
        data_tests:
          - not_null
      - name: PLATFORM
        description: "iOS or Android"
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: ['iOS', 'Android']
      - name: CHANNEL
        description: "Standardized ad partner name from AD_PARTNER mapping"
        data_tests:
          - not_null
      - name: INSTALLS
        description: Count of distinct device IDs installed on this date
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns:
              - DATE
              - PLATFORM
              - CHANNEL

  - name: int_mmm__daily_channel_revenue
    description: >
      Daily revenue by channel and platform for MMM input.
      Source: Adjust API daily report (stg_adjust__report_daily).
      Uses pre-aggregated API data to avoid dependency on broken device mapping pipeline.
      Revenue is event-date based (not install-cohort based) -- MMM handles lag statistically.
    columns:
      - name: DATE
        description: Calendar date of revenue events
        data_tests:
          - not_null
      - name: PLATFORM
        description: "iOS or Android"
        data_tests:
          - not_null
          - accepted_values:
              arguments:
                values: ['iOS', 'Android']
      - name: CHANNEL
        description: "Standardized ad partner name via network_mapping seed"
        data_tests:
          - not_null
      - name: REVENUE
        description: "Adjust-reported revenue for this channel"
      - name: ALL_REVENUE
        description: "Adjust all_revenue metric (includes all revenue types)"
      - name: AD_REVENUE
        description: "Ad-based revenue (rewarded video, interstitials, etc.)"
      - name: API_INSTALLS
        description: "Install count from API (for cross-check with S3 installs)"
    data_tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns:
              - DATE
              - PLATFORM
              - CHANNEL
