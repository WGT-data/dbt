version: 2

models:
  - name: mta__campaign_performance
    description: |
      Multi-Touch Attribution Campaign Performance - compares 5 attribution models side-by-side.
      Use this to understand how different attribution methodologies affect campaign performance metrics.

      Attribution Models:
      - Last-Touch: 100% credit to last touchpoint before install
      - First-Touch: 100% credit to first touchpoint in journey
      - Linear: Equal credit split among all touchpoints (weighted by click vs impression)
      - Time-Decay: Exponential decay with 3-day half-life (recommended)
      - Position-Based: 40% first, 40% last, 20% middle

      Grain: One row per AD_PARTNER + CAMPAIGN_ID + PLATFORM + DATE
    columns:
      - name: AD_PARTNER
        description: Standardized partner name (Meta, Google, TikTok, etc.)
      - name: CAMPAIGN_ID
        description: Network campaign identifier
      - name: PLATFORM
        description: iOS or Android
      - name: DATE
        description: Install date
      - name: COST
        description: Ad spend from Supermetrics
      - name: INSTALLS_LAST_TOUCH
        description: Installs attributed via last-touch model
      - name: INSTALLS_TIME_DECAY
        description: Installs attributed via time-decay model (recommended)
      - name: D7_ROAS_TIME_DECAY
        description: 7-day ROAS using time-decay attribution
      - name: D30_ROAS_TIME_DECAY
        description: 30-day ROAS using time-decay attribution
      - name: CPI_TIME_DECAY
        description: Cost per install using time-decay attribution

  - name: rpt__mta_vs_adjust_installs
    description: |
      Side-by-side comparison of MTA-attributed installs vs Adjust's reported installs
      at network level. No Amplitude dependency — purely Adjust data.

      Three install perspectives:
      1. ADJUST_REPORTED_INSTALLS — Adjust API daily report (dashboard numbers)
      2. ADJUST_S3_INSTALLS — Device-level count from raw S3 install data
      3. MTA_*_INSTALLS — Fractional installs from 5 MTA attribution models

      Key comparison metrics:
      - MTA_COVERAGE_PCT: % of Adjust installs that MTA can see (~0% for SANs)
      - MTA_CREDIT_SHIFT_PCT: How time-decay redistributes credit vs last-touch
      - HAS_TOUCHPOINT_DATA: Whether the network shares device-level touchpoints

      Known limitations:
      - SANs (Meta, Google, TikTok, Apple) do not share device-level touchpoints,
        so MTA coverage will be ~0% for those networks
      - iOS IDFA consent ~7% limits iOS MTA coverage even for programmatic networks
      - Android device matching works for Adjust-to-Adjust (GPS_ADID)

      Grain: One row per AD_PARTNER + PLATFORM + DATE
    columns:
      - name: AD_PARTNER
        description: Standardized partner name (Meta, Google, Moloco, etc.)
      - name: PLATFORM
        description: iOS or Android
      - name: DATE
        description: Install date
      - name: ADJUST_REPORTED_INSTALLS
        description: Installs reported by Adjust's API daily report (their last-touch attribution)
      - name: ADJUST_S3_INSTALLS
        description: Distinct device count from raw S3 install events
      - name: MTA_TIME_DECAY_INSTALLS
        description: MTA-attributed installs using time-decay model (recommended)
      - name: MTA_COVERAGE_PCT
        description: MTA installs / Adjust reported installs — shows data coverage gap
      - name: MTA_CREDIT_SHIFT_PCT
        description: |
          (time_decay - last_touch) / last_touch — how much MTA redistributes credit.
          Positive = network gains credit from multi-touch analysis.
          Negative = network was over-credited by simple last-touch.
      - name: HAS_TOUCHPOINT_DATA
        description: Whether this network shares device-level touchpoints (FALSE for SANs)

  - name: rpt__web_attribution
    description: |
      Web traffic attribution report with multi-touch attribution for registrations.
      Surfaces web attribution data from Amplitude with proper MTA using 5 attribution
      models side-by-side so you can see how credit shifts between channels (e.g.,
      Facebook drives discovery but users return via Google/direct to register).

      Multi-Touch Attribution:
      Uses the int_web_mta pipeline which links anonymous pre-registration browser
      sessions to registrations via Amplitude's DEVICE_ID identity bridge.
      5 attribution models: last-touch, first-touch, linear, time-decay, position-based.

      Total Traffic Volume:
      Also counts ALL anonymous web sessions (not just converting ones) to show
      the full traffic funnel: sessions → registrations.

      Traffic Source Logic:
      1. If utm_source is present, use it
      2. Else if referring_domain is present, use it (organic search, social, etc.)
      3. Else 'direct'

      Grain: One row per DATE + TRAFFIC_SOURCE + TRAFFIC_MEDIUM + TRAFFIC_CAMPAIGN
    columns:
      - name: DATE
        description: Event date (session date for traffic, touchpoint date for registrations)
      - name: TRAFFIC_SOURCE
        description: |
          utm_source if present, else referring_domain, else 'direct'.
          Examples: facebook, wgtemail, google, www.google.com, www.bing.com, direct
      - name: TRAFFIC_MEDIUM
        description: |
          utm_medium value. Examples: RT-ads, email, youtube, web, app, cpc.
          NULL when traffic source is organic referrer or direct.
      - name: TRAFFIC_CAMPAIGN
        description: |
          utm_campaign value. Examples: flashgone, desktop-newreg, desktopvideoads-Apr2025, wgtemail_36243.
          NULL when not set in URL params.
      - name: SESSIONS
        description: Count of distinct anonymous session_start events (all web traffic, not just converting)
      - name: UNIQUE_DEVICES
        description: Count of distinct browser DEVICE_IDs (anonymous visitors)
      - name: REGS_LAST_TOUCH
        description: Registration credit using last-touch model (100% to last session before registration)
      - name: REGS_FIRST_TOUCH
        description: Registration credit using first-touch model (100% to first session in journey)
      - name: REGS_LINEAR
        description: Registration credit using linear model (equal credit across all sessions)
      - name: REGS_TIME_DECAY
        description: Registration credit using time-decay model with 3-day half-life (recommended)
      - name: REGS_POSITION_BASED
        description: Registration credit using position-based model (40% first, 40% last, 20% middle)
      - name: UNIQUE_REGISTRANTS
        description: Count of distinct game USER_IDs who registered via this source on this date
      - name: GCLID_SESSIONS
        description: Sessions with a Google Ads click ID (gclid) present
      - name: FBCLID_SESSIONS
        description: Sessions with a Facebook click ID (fbclid) present
